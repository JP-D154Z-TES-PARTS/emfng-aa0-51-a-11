# タスク実施ガイド - emfng-aa0-51-a 対応

## 本ガイドについて

本ガイドは、タスク1（仕様書差分分析）の結果に基づき、後続タスク2～4を効率的に実施するための参考資料です。

## 変更概要（クイックサマリー）

### バージョン情報
- **Base**: emfng-aa0-50-a (2025年6月30日)
- **New**: emfng-aa0-51-a (2025年9月17日)
- **期間**: 約2.5ヶ月

### 主要変更内容
1. **t-CORE対応**（ロジック変更シート S51a より）
   - DI/PFI異常検出タイミング仕様不備対応
   - レベルアップ版の変更
   
2. **c_matファイル差し替え不要化**
   - emfng_4_c_mat.c：差し替え不要（50-aから継続使用）
   - emfng_6_c_mat.c：差し替え不要（50-aから継続使用）

## タスク2: ソースコード変更実装

### 事前確認項目
- [ ] ロジック変更シート S51a の全内容を確認
- [ ] t-CORE対応の詳細仕様を理解
- [ ] DI/PFI異常検出タイミングの現在の実装を確認
- [ ] base版のc_matファイルの内容を確認

### 変更対象ファイル（想定）
```
base/emfng-aa0-50-a_src/
  ├── emfng.h                  # ヘッダーファイル（変更可能性あり）
  ├── emfng_4_c_mat.c         # 4気筒用（差し替え不要、継続使用）
  ├── emfng_6_c_mat.c         # 6気筒用（差し替え不要、継続使用）
  └── emfng_l_mat.c           # ロジック本体（変更可能性あり）
```

### 実装手順（推奨）
1. S51a の詳細内容を精読（258行の変更内容）
2. t-CORE対応に必要なコード変更箇所を特定
3. DI/PFI異常検出タイミング関連のコードを修正
4. c_matファイルは50-aから継続使用（変更不要）
5. ヘッダーファイルのバージョン情報を更新
6. コードレビューとビルド確認

### 確認ポイント
- [ ] t-CORE対応の仕様が正しく実装されているか
- [ ] DI/PFI異常検出タイミングの不備が修正されているか
- [ ] c_matファイルの互換性に問題がないか
- [ ] 4気筒/6気筒両方の構成で動作するか
- [ ] バージョン番号が51-aに更新されているか

## タスク3: テストケース作成

### テスト観点
1. **t-CORE対応の動作確認**
   - t-COREモードでの動作確認
   - 従来モードとの互換性確認
   
2. **DI/PFI異常検出タイミング**
   - 正常系: 適切なタイミングで異常を検出
   - 異常系: 不適切なタイミングで誤検出しない
   - 境界値テスト
   
3. **c_matファイル継続使用の確認**
   - 50-a版c_matファイルでの動作確認
   - 4気筒構成での動作確認
   - 6気筒構成での動作確認

### テストケース項目（例）
```
TC-001: t-COREモード有効時の失火検出
TC-002: t-COREモード無効時の失火検出（回帰テスト）
TC-003: DI異常検出タイミング（正常系）
TC-004: DI異常検出タイミング（境界値）
TC-005: PFI異常検出タイミング（正常系）
TC-006: PFI異常検出タイミング（境界値）
TC-007: 4気筒構成での全体動作確認
TC-008: 6気筒構成での全体動作確認
TC-009: c_mat継続使用時の動作確認
```

### テスト環境
- [ ] 4気筒テスト環境
- [ ] 6気筒テスト環境
- [ ] t-CORE対応テスト環境
- [ ] DI/PFI異常検出シミュレーション環境

## タスク4: ドキュメント更新

### 更新対象ドキュメント
1. **README.md** または **仕様書**
   - バージョン番号: 50-a → 51-a
   - 日付: 2025/6/30 → 2025/9/17
   - 変更内容の概要記載
   
2. **ビルド・デプロイ手順書**
   - c_matファイル差し替え手順の削除または注釈追加
   - 「50-a版のc_matファイルを継続使用」と明記
   
3. **変更履歴**
   - S51aの変更内容を記録
   - t-CORE対応の経緯と内容
   - DI/PFI異常検出タイミング修正の詳細

4. **テスト仕様書**
   - 新規テストケースの追加
   - t-CORE対応テストの記載
   
5. **リリースノート**
   - 51-aリリースの概要
   - 主要な変更点のサマリー
   - 移行時の注意事項

### ドキュメント更新チェックリスト
- [ ] バージョン番号の一括更新
- [ ] 日付情報の更新
- [ ] c_matファイル取り扱いの説明更新
- [ ] t-CORE対応の説明追加
- [ ] DI/PFI異常検出タイミング修正の説明追加
- [ ] 変更履歴の追記
- [ ] 図表の更新（必要に応じて）

## 重要な注意事項

### c_matファイルについて
⚠️ **重要**: 4気筒用・6気筒用の両c_matファイルは、50-a版を継続使用します。
- 新規にファイルを作成しないこと
- 既存ファイルを削除しないこと
- base版のファイルをそのまま参照すること

### t-CORE対応について
⚠️ **必読**: ロジック変更シート S51a に詳細な仕様が記載されています。
- S51aシートの全130行を確認すること
- 「レベルアップ」版の変更であることを認識すること
- 適合方法・評価条件を議論・確認すること

### テストについて
⚠️ **必須**: 4気筒/6気筒の両構成でテストを実施してください。
- 片方の構成だけでのテストは不十分
- 実機またはシミュレーション環境での確認
- 回帰テストも忘れずに実施

## 参照ドキュメント

### タスク1成果物
- [差分分析レポート.md](./差分分析レポート.md) - 詳細な差分分析結果
- [変更点一覧.md](./変更点一覧.md) - 変更点の表形式一覧
- 本ガイド（タスク実施ガイド.md） - 実施手順のガイド

### 仕様書（Base版）
- base/emfng-aa0-50-a_spec/D0emfng-aa0-50-a.doc
- base/emfng-aa0-50-a_spec/D0emfng-aa0-50-a(4).xls
- base/emfng-aa0-50-a_spec/D0emfng-aa0-50-a(6).xls
- base/emfng-aa0-50-a_spec/document/ロジック変更シート_ver9.06_emfng-aa0.xlsx

### 仕様書（New版）
- new/emfng-aa0-51-a/D0emfng-aa0-51-a.doc
- new/emfng-aa0-51-a/D0emfng-aa0-51-a(4).xls
- new/emfng-aa0-51-a/D0emfng-aa0-51-a(6).xls
- new/emfng-aa0-51-a/document/ロジック変更シート_ver9.09_emfng-aa0.xlsx
  - **特に重要**: S51a シート（130行 x 51列）

### ソースコード（Base版）
- base/emfng-aa0-50-a_src/emfng.h
- base/emfng-aa0-50-a_src/emfng_4_c_mat.c（継続使用）
- base/emfng-aa0-50-a_src/emfng_6_c_mat.c（継続使用）
- base/emfng-aa0-50-a_src/emfng_l_mat.c

## 質問・不明点がある場合

以下の順序で確認・対応してください：

1. **差分分析レポート.mdを再確認**
   - 詳細な差分内容が記載されています
   
2. **仕様書の該当箇所を確認**
   - 特にロジック変更シート S51a を精読
   
3. **変更点一覧.mdで影響範囲を確認**
   - 影響度と具体的な変更内容を確認
   
4. **担当者・レビュワーに相談**
   - 技術的な判断が必要な場合

## タスク完了チェックリスト

### タスク2完了時
- [ ] S51a仕様を完全に理解した
- [ ] t-CORE対応の実装が完了した
- [ ] DI/PFI異常検出タイミング修正が完了した
- [ ] バージョン番号が更新された
- [ ] ビルドが成功した
- [ ] 静的解析をパスした

### タスク3完了時
- [ ] テストケースが作成された
- [ ] 4気筒構成でのテストが完了した
- [ ] 6気筒構成でのテストが完了した
- [ ] t-CORE対応のテストが完了した
- [ ] 回帰テストが完了した
- [ ] すべてのテストがパスした

### タスク4完了時
- [ ] 全ドキュメントが更新された
- [ ] バージョン情報が一貫している
- [ ] 変更履歴が記録された
- [ ] リリースノートが作成された
- [ ] レビューが完了した

---

**作成日**: 2025-10-17  
**タスク1（仕様書差分分析）**: 完了  
**次のステップ**: タスク2（ソースコード変更実装）へ進む
