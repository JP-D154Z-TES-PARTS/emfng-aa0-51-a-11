# emfng-aa0-51-a-11
仕様書管理リポジトリ - 作成日時: 2025-10-17T14:59:42.965941

## リポジトリ構成

```
emfng-aa0-51-a-11/
├── base/                           # ベース版（emfng-aa0-50-a）
│   ├── emfng-aa0-50-a_spec/        # 仕様書
│   │   ├── D0emfng-aa0-50-a.doc    # メイン仕様書
│   │   └── document/               # 関連ドキュメント
│   └── emfng-aa0-50-a_src/         # ソースコード
│       ├── emfng_l_mat.c           # 失火OBD診断メインコード
│       ├── emfng.h                 # ヘッダファイル
│       ├── emfng_4_c_mat.c         # 4気筒用コード
│       └── emfng_6_c_mat.c         # 6気筒用コード
├── new/                            # 新版（emfng-aa0-51-a）
│   └── emfng-aa0-51-a/             # 新版ファイル
│       └── D0emfng-aa0-51-a.doc    # 新版仕様書
└── [分析ドキュメント]              # Task2で作成
    ├── analysis_summary.md          # 分析結果サマリ
    ├── base_spec_code_mapping.md    # 仕様書とコードの対応関係マップ
    └── function_specification_table.md  # 関数一覧と仕様書対応表
```

## 分析ドキュメント（Task2成果物）

### 📄 analysis_summary.md
**分析結果のサマリドキュメント**

- Task2の実施内容と成果物の概要
- 処理タイミング構造の全体像
- 主要機能カテゴリの分類
- 失火診断の種類と判定方法
- コンパイルスイッチ構成
- Task4での活用方法

👉 **最初にこのドキュメントを読むことを推奨**

### 📊 base_spec_code_mapping.md
**仕様書とコードの詳細対応関係マップ**

- 仕様書セクションと対応関数のマッピング
- 処理タイミング別の関数配置（TDC、16ms、65ms）
- 検出許可カウンタ、失火カウンタ、異常判定の詳細
- データフロー（入力データ/出力データ）
- コンパイルスイッチと条件分岐の影響分析
- 処理フロー図とアルゴリズム解説
- メモリ管理と依存関係

👉 **仕様書とコードの論理的な対応関係を理解したい場合**

### 📋 function_specification_table.md
**全関数の一覧と仕様書対応表**

- 60個の関数の完全一覧とカテゴリ分類
- 各関数の詳細仕様（パラメータ、戻り値、処理概要）
- 関数呼び出し階層図
- 仕様書セクションと関数の対応マトリクス
- コンパイルスイッチ別の関数有効化
- 重要な関数の詳細仕様解説
- 変更時の影響範囲分析
- Task4での使用方法（差分抽出手順）

👉 **関数レベルの詳細情報や実装時の参照用**

## 部品概要

**部品番号**: emfng-pa000-5000-a-M4  
**名称**: 複数気筒ミスファイア判定部  
**目的**: 失火OBD診断（触媒OTレベル、EM悪化レベル、DI/PFI失火検出）  
**対応システム**: 4気筒、6気筒（ω法、ΔT法）  
**法規対応**: 対米法規（OBD2）、制御再構築

## 主要機能

### 失火診断の4種類

1. **触媒OTレベル失火判定** - 触媒過熱防止
2. **EM悪化レベル失火判定** - エミッション悪化検出
3. **DI失火判定** - 直噴噴射時の失火（デュアルINJ時）
4. **PFI失火判定** - ポート噴射時の失火（デュアルINJ時）

### 処理タイミング

- **TDC周期（中）**: 検出許可カウンタ操作、失火カウンタ操作
- **16ms周期（低）**: 16ms周期処理
- **65ms周期（低）**: 異常判定、電技通知、Mode06データ計算

## Task進捗

- ✅ **Task1**: 差分分析（前提条件）
- ✅ **Task2**: base仕様書とl_mat.cの対応関係分析（完了）
- ⏳ **Task3**: new仕様書とコードの分析
- ⏳ **Task4**: ロジック差分の実装

## 使い方

### 1. 初めて読む方
1. `analysis_summary.md` で全体像を把握
2. `base_spec_code_mapping.md` で仕様書とコードの対応を理解
3. `function_specification_table.md` で関数の詳細を確認

### 2. Task4でロジック差分を実装する方
1. `function_specification_table.md` の関数一覧を基にnew版の関数一覧を作成
2. 追加/削除/変更された関数を特定
3. `base_spec_code_mapping.md` の処理フローと比較
4. 差分を実装

### 3. 特定の機能を調べたい方
- **処理タイミング**: `base_spec_code_mapping.md` の「2.1 主要処理タイミング」
- **関数の詳細**: `function_specification_table.md` の「2. 関数対応表」
- **データフロー**: `base_spec_code_mapping.md` の「4. データフロー」
- **コンパイルスイッチ**: `base_spec_code_mapping.md` の「5. コンパイルスイッチと条件分岐」

## 技術情報

### コード統計
- **ファイル**: emfng_l_mat.c
- **行数**: 4,395行
- **関数数**: 60個
- **コンパイルスイッチ**: 12種類

### 開発環境
- **言語**: C言語
- **対象ECU**: Toyota ECU
- **制御周期**: TDC、16ms、65ms

## 参考資料

- base仕様書: `base/emfng-aa0-50-a_spec/D0emfng-aa0-50-a.doc`
- baseソースコード: `base/emfng-aa0-50-a_src/emfng_l_mat.c`
- new仕様書: `new/emfng-aa0-51-a/D0emfng-aa0-51-a.doc`

---
**更新日**: 2025-10-17  
**Task**: Task2完了
